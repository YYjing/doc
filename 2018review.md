# 2018年反思
在介绍下面主体的时候，先介绍一下项目特点。我们做的是一个企业安全项目。这个项目的特点是参与人比较多。需要大改20个左右的前端，开发3个月时间。也就是60人月的项目。3个月时间里面最后一个月会反复进行大范围测试，测试也是十多个人。并且，这个项目会反复迭代。一年一个大版本，几个小版本。

之所以先介绍项目人月，是因为不同规范项目、不同特点项目面对的问题、需要关注的问题都不太一样。
## 文档
文档主要讲的是产品文档、技术文档。

产品文档主要包含产品的prd、产品的原型图、产品的规格文档等等

技术文档主要包含技术的规范性文档。例如接口规范文档、前端代码各种规范。
### 产品文档
产品属于真个产品周期的源头，产品的准确传递对整个项目影响最大。产品文档的错误和不规范会导致后续的设计、开发、测试递增性工作量。

我们的产品文档经历过几个阶段。

**第一阶段**

产品把产品需求写了一个完备的prd文档，以word和pdf的格式递交给开发。开发和测试依据这些文档进行开发和测试。

这样的好处是产品需求有处可查。但是随着开发过程中，产品的修改。这个文档会反复修改。修改过程中因为word格式的性质、导致了最终出现了四五份产品文档，每一份文档内容新旧不同。到了最后产品文档陷入了灾难。没人知道那些是正确的，那些事新的，那些事旧的。还有一些需求直接以蓝信聊天的方式发送、有些是口头传递、最终产品需求散落各处，陷入了混沌。

后期因为人员变动，遇到功能新增或者维护，没有人能够说出来这块功能如何设计；或者新接手的人需要寻找几天人才能搞懂之前功能的一块设计意图。

第一阶段我们通过word或pdf记录需求，我们最终陷入了有文档、不可用的境地。



**第二阶段**

鉴于第一阶段文档虽多、维护和使用成本过高、后期无文档可用的情况。这个阶段我们采取只要原型、具体的产品需求对应的产品、开发、测试建立小群单独沟通的聊天沟通方式进行。

这种方式的好处是，简单高效。不用维护细致、繁琐的文档、只用出关键的一些规格文档。前期开发过程中依靠开发和产品的频繁review，开发效率相对纯粹参考文档有一定提升。

这种方式也有一定的隐患。项目后期的维护、其他定制化团队开发和维护遇到需求问题的时候只能去询问对应的产品。如果对应的产品和开发、测试出现人员变动的话，这个需求就没人可以说清楚了。

**当前阶段**
wiki和jira这样的企业管理工具我们也用的比较多。wiki这样的文档工具没能大面积使用，很多时候很多同学不去看、或者找不到对应的文档。另外wiki的在线编辑模式体验不够好，再加上不少同学不会使用wiki，所以这样集成工作的文档管理工具没有很好的用起来。

鉴于之前的wiki没有很好的发挥作用。我们利用gitlab的wiki和git里面自己建设的doc目录来归纳和总结文档。

**下一个阶段**



如果wiki进行大范围培训、规范使用，wiki操作更简便，也许wiki是不错的工具。

寻找到更好的团队协作文档工具，方便产品的及时更新、产品的集中管理。

理想中类似一些开源的github规范的文档就挺好，例如openapi这样的纯文本文档。
或者类似vue这些技术文档。这些文档都是纯文本、容易编辑、可以离线操作、查看、也很容易协作。

### 技术文档

接口文档后端通过一个svn上面的word提供了出来。因为svn权限文档和word的不方便版本记录的问题。这个规范传播和参与度比较差。最好还是容易修改、分享的纯文本格式。

基础组件和业务代码里面的文档和注释没有统一规范，影响了基础组件的使用和传播。也影响了业务代码的统一。

后面添加jsdoc类似的工具，规范文档书写格式。这样文档的更新和规范都能得到保证。

## 微服务
首先我们开发的项目比较大，压缩打包后部署代码就有50M以上。

**前期**

因为项目过大，代码的开发启动和构建都比较耗时。其他团队听到过打包半个小时的情况。我们团队重启一下开发环境也需要去上个厕所、抽根烟。

项目提测阶段，一个小bug就需要重新花费十多分钟重新打包。

一个模块里面的一个错误，可能导致其他模块的错误和崩溃。例如因为是一个巨型spa，全范围寻找内存泄露就需要两天时间。

因为部署的是一套代码，一个小改动，就需要全量前端代码替换。测试需要付出巨大工作量，保证项目的正确性。

**现在**

后来有同事把微服务引入到了开发中。我们把项目拆分为了十多个模块，每个模块单独开发部署、测试。现在每个模块都可以秒开，模块内部的错误也不会影响到其他模块，每个模块可以单独开发、部署、测试。


**微服务和SPA**

微服务上线后，领导突然吐槽每个模块点击就页面空白去刷新。要求改善体验。

微服务改为spa根据要求、工作量有很多办法，是个大课题。

可以把微服务修改打包方式，打包的时候打成spa，这样就丧失微服务的一些优点了。

还可以使用一些开源的微服务框架，这个需要对现有的模块进行大范围修改

最终，我们采用iframe的方式来做微服务的spa

每个子系统，当打开其他系统的时候，就好创建一个iframe去加载其他子系统，加载完成够显示在页面。这样加载其他子系统的时候，相互之间可以比较平滑的切换，用户体验会很好。

此外，这样的系统在做插件化的时候，相比之前纯粹的spa也有很大的优势。传统的spa插件化只能支持同框架，例如vue做的spa去支持react的插件化子项目的时候就比较麻烦。但是微服务的时候，对框架是没有限定的。
## 测试
## 组件库
## 规范
## 开发环境